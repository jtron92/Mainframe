
Performing IPL

Introduction

Performing IPL is pretty straightforward activity when everything goes well. You always need a checklist that will guide you through the entire process, it will help you to avoid many possible mistakes in the process.

Quite often you'll encounter problems during IPL. They may be very common, for example automation fails to close certain task or very serious like some Wait States. In this assignment you'll also learn how to perform some non-standard IPL activities.

As previously IPL term refers here to System Restart. In only one phase is required it will be mentioned as System Shutdown or System Load.

This Assignment can be done only on the system where you are primary System Programmer. Do not do it on any other test system!

Tasks

1. Perform standard IPL.

2. Perform another IPL. This time close all tasks manually.

3. Imagine there is a time change. You need to IPL system with new time. Copy member responsible for time definition so you'll have two members, one for summer time and one for winter time. Modify IMSI so you are able to specify which member is used during System Load.
Hint 1

Hint 2

Solution 1

Refer to checklist you've created in “IPL Basics” Assignment, in short:
1. Gather all useful information from the system.
2. Close job submission and JES2/WLM initiators.
3. Check if jobs are running. Either wait or cancel them.
4. Issue automation shutdown command that will close tasks.
5. Monitor shutdown and fix any problems if they appear.
6. When all tasks are down issue 'Z EOD' command.
7. Perform 'Reset Clear'.
8. Perform 'Load'.
9. Monitor load and fix any problems if they appear.
10. When tasks are up compare tasks status and other system setting(if needed) with data gathered before IPL and fix any problems if they occur.
Solution 2

You should do the same steps as in Task#1, the only difference is that instead of issuing shutdown command you'll close all tasks on system manually.

Closure order, task types and name can be different on every installation. Here is list with some universal commands and rules.

Most tasks can be closed with use of standard commands:
P taskname
C taskname
FORCE taskname,ARM
FORCE taskname

Here is proper procedure for closing jobs and tasks. Of course it's best to have access to the task output in SDSF and monitor it there. This procedure can be used from any console:
1. Issue 'P taskname'. 'P' command is not supported by every standard task, if that's the case go to point 3.
2. Check why task isn't closed.
- Sometimes you must simply wait a while. Use 'D A,taskname' command, 'CT' parameter there shows amount of processor time used by the task, if this value is increasing task is processing something and most likely it will close soon.
- Check if there are any pending messages related to the task: 'D R,L'. Sometimes tasks issue WTOR after receiving stop command.
- Check contention: 'D GRS,C'. Sometimes tasks may be stuck because of some unavailable resource.
3. Issue 'C taskname'. If you'll get “IEE841I taskname NON-CANCELABLE” message go to point 6.
4. Issue 'C taskname,A=asid'. Use 'D A,taskname' to display task ASID.
5. Check why task isn't closed (repeat steps described in point 2).
6. Issue 'FORCE taskname,ARM'. This kills task so you shouldn't wait long.
7. Check why task isn't closed (repeat steps described in point 2).
8. Issue 'FORCE taskname'. This is strongest command, use it only if you know you can do it for specific tasks. In some cases issuing it will cause data lost and may be serious problem.

To start particular tasks you should simply issue 'S taskname,parameters' commands. Some tasks needs additional parameters (CICS for example), others don't.
There can be of course many problems during startup. Use 'D A,taskname' command to check if it's address space is started. Also check WTOs 'D R,L' and contention 'D GRS,C'.


Here are instructions for some tasks that are closed/started in non-standard way.

AOPD (InfoPrint Server)
InfoPrint consists of many tasks so it is closed and started by procedures shipped with the product:
'S AOPSTOP'
'S AOPSTART'

CICS:
Shutdown:
- 'F cicsname,CEMT P SHUT'
- 'F cicsname,CEMT P SHUT,I'
- 'C cicsname'
Startup:
- 'S CICSNAME,START=AUTO' – Some CICSes are always started in COLD, but if you don't have specific instructions AUTO mode should be used.

DB2:
Shutdown:
- 'db2pref STOP DB2'
- 'db2pref STOP DB2 MODE(FORCE)'
- 'C db2name'
Startup:
- 'db2pref START DB2'
These command (except Cancel) should also start/stop main DB2 address spaces so you don't have to close IRLM, DBM1 etc manually.

DFHSM:
Shutdown:
- 'F hsmname,STOP'
- 'C hsmname'
Startup:
- 'S hsmname'

JES2:
Pre-shutdown:
- '$PI' – stop initiators. Also '$PXEQ' if you have some WLM controlled initiators.
- 'F BPXOINIT,SHUTDOWN=FORKINIT' – stops UNIX initiators.
- '$PLINE1-99' – stops JES2 lines.
JES2 wont close until jobs or tasks are running under it. Use '$DJES2' command to check names of those tasks.
Shutdown:
- '$PJES2'
- '$PJES2,ABEND'
Startup:
- 'S JES2,SUB=MSTR'
Certain tasks like JES2 or CNMS(NetView Automation) must run under Master Scheduler address space 'SUB=MSTR' parameter does the trick.
Post-startup:
- '$SLINE1-99'
- 'F BPXOINIT,RESTART=FORKS'
- '$SI1-6' and '$SXEQ'

VTAM:
Shutdown:
- 'Z NET,QUICK'
- 'Z NET,CANCEL'
Startup:
- 'S VTAM,,,(LIST=xx)'
NET is also used as VTAM name. Other variants may be 'S NET,,,(LIST=xx),SUB=MSTR' or simply 'S VTAM'. As always it depends on the system setting.

OMVS:
Closing OMVS is more complicated and a lot depends on the installation.
Note that OMVS must be closed after TCPIP is down since TCPIP uses OMVS services. It's best to close OMVS just before JES2 as one of the last active address spaces.
Shutdown:
- 'F OMVS,STOPPFS=NFS' – closes Network File System, it prevents data lost.
- 'F BPXOINIT,SHUTDOWN=FORKS' – stops UNIX initiators running under JES2.
- 'F OMVS,SHUTDOWN' – standard OMVS shutdown command.
Sometimes you may also need to close ZFS although it should be automatically closed during OMVS closure:
- 'F OMVS,STOPPFS=ZFS'
Startup:
- OMVS is always start automatically so there shouldn't be any problems with startup.

TWS (Tivoli Workload Scheduler):
TWS consist from at least two address spaces: controller (TWSC here) and tracker (TWST). They should be closed/started in specific order.
Shutdown:
- 'P TWSC' then 'P TWST'
- 'C TWSC' then 'C TWST'
Startup:
- 'S TWST' then 'S TWSC'
Solution 3

IMSI value we're interested in is 'S'. With it you can specify IEASYSxx member prefix. You can also overwrite any initialization parameter in IEASYSxx.

Note that no matter what IEASYSxx member you specify in LOADxx member IEASYS00 is always used. So if in LOADxx member you have SYSPARM=(US,99) your system will be initialized with parameters from following members:
IEASYS00
IEASYSUS
IEASYS99
Each later member in concatenation has higher priority so if the same parameter is coded in all three members the one from IEASYS99 is actually used.

When you use IMSI 'S' value you'll be prompted with IEA101A WTOR. It always have number 0. Answer may consist of many sub-parameters for example:
'0,SYSP=01,CMD=(01,XY)'

The most important parameter is SYSP, you should always remember to specify it. Answer to this WTOR overwrites SYSPARM statement in LOADxx member. This means that if you'll answer without SYSP parameter, for example: '0,CMD=05' you'll simply nullify SYSPARM and in effect system will use only IEASYS00 member.

Here are steps needed to finish this assignment:

1. Check which IEASYSxx member are used by your installation. Use 'D IPLINFO' command to find out LOADxx member used by your system. In it you'll have either suffix for IEASYSxx member. If not you should check it in appropriate IEASYMxx member.

2. Check in IEASYSxx which CLOCKxx member is currently used and copy it with different prefix. For example you can use CLOCKST (summer time) and CLOCKWT (winter time).

3. Modify copied clock member so it can be used during time change. Only parameter that needs to be changed is TIMEZONE:
TIMEZONE E.01.00.00 – this is value for Polish winter time. 'E' means that your time zone is in the East from UTC time zone (UTC+1 in this example).

4. Shutdown System.

5. Change IMSI to 'S' and load system. 

6. You'll be prompted with “IEA101A SPECIFY SYSTEM PARAMETERS FOR z/OS...” WTOR. Answer it accordingly to your system configuration, for example:
“0,SYSP=US,CLOCK=WT”

In this case system uses only one alternate IEASYSxx member (SYSP=US), parameters from IEASYS00 and IEASYSUS are used.

CLOCK=WT overwrites CLOCK parameter from IEASYSxx members. In this case CLOCKWT is used.


Note:
This is just an exercise, the best way to change time is to use "T TIMEZONE=E.01" command and modify CLOCKxx accordingly, no IPL is needed. Still IPLs are often done during time change to avoid problem with time change for various tasks.
