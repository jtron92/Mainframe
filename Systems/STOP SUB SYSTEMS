C INETD4 
C DFSCM 
PAUSE 10 
P TSO 
P LLA 
SETRRS CANCEL 
P VLF 
C HTTPD1 
C NFSS 
C NFSC 
MODIFY DLF,MODE=NORMAL 
P DLF 
F CICSA,CEMT P SHUT I 
PAUSE 20 
PAUSE 10      /* WAIT FOR SYS TO GET UP FIRST  */ 
P TCPIP 
P TN3270 
PAUSE 5 
P SDSF 
PAUSE 10 
%CSQ7 STOP CHINIT 
PAUSE 5 
%CSQ7 STOP QMGR 
PAUSE 10 
Z NET,QUICK 
PAUSE 10 
F OMVS,STOPPFS=NFS
F OMVS,STOPPFS=ZFS 
F BPXOINIT,SHUTDOWN=FORKS 
#STOP 

F DBBGADMT,APPL=SHUTDOWN
-DBBG STOP DB2
F CICSTS52,CEMT P SHUT I



04 BPXI078D STOP OF ZFS REQUESTED. REPLY 'Y' TO        
     * PROCEED. ANY OTHER REPLY WILL CANCEL THIS STOP.      


-STOP DB2 MODE(FORCE)

















































Planned shutdowns using F BPXOINIT,SHUTDOWN=...
Last Updated: 2021-06-25
When you are doing a planned shutdown of z/OS UNIX, follow the instructions in Steps for shutting down z/OS UNIX using F BPXOINIT,SHUTDOWN=.... As part of a planned shutdown, you need to prepare the file systems before shutting down z/OS UNIX by issuing one of these commands:

F BPXOINIT,SHUTDOWN=FILEOWNER
F BPXOINIT,SHUTDOWN=FILESYS

Issuing one of these commands synchronizes data to the file systems and possibly unmounts or moves ownership of the file systems. If you use SHUTDOWN=FILEOWNER, the system is disabled as a future file system owner via move or recovery operations until z/OS UNIX has been restarted.

Restriction: SHUTDOWN=FILEOWNER is valid only in a shared file system configuration.
If you get message BPXM048I saying that the file system shutdown was incomplete, a local mount might have been performed while the shutdown was in progress. To identify the file systems that were not moved or unmounted, issue D OMVS,F,O on the source system to see which file systems are still owned by this system. You can try to move individual file systems by issuing the following operator command for each file system in question:

 SETOMVS FILESYS,FILESYSTEM=xxxxxxxx,SYSNAME=yyyyyyyy

If a move fails, you will see message BPXO037E.

Automounted file systems are not mounted during the processing of F BPXOINIT,SHUTDOWN=FILEOWNER, or after it completes in order to provide the ability to handle unexpected mounts that occur when a file system is shut down.

In a shared file system configuration, the resulting system actions are more complex, because they might involve the movement of file system ownership between systems in the shared file system. For more information about the system actions that might occur in a shared file system, see Implications of shared file systems during system failures and recovery.

To shut down the system as part of JES maintenance without reIPLing the system, see Partial shutdowns for JES2 maintenance.




Steps for shutting down z/OS UNIX using F BPXOINIT,SHUTDOWN=...
Last Updated: 2021-06-25
About this task
You will shut down z/OS® UNIX using the F BPXOINIT,SHUTDOWN=... system command.
Before you begin: You need to notify users that the system is being shut down and ask them to log off. If you do not shut down and quiesce the UNIX workload, these critical system functions might be ended abnormally during the shutdown, which might cause several failures on the system. As a result, the system might not be shut down successfully.

    Use the operator SEND command to send a note to all TSO/E users telling them that the system will be shut down at a certain time. For example:

    send 'The system is being shut down in five minutes. Log off.',NOW

    Use the wall command to send a similar note about the impending shutdown to all shell users who are logged on. For example:

    wall The system is being shut down in five minutes. Please log off.

Perform the following steps to shut down z/OS UNIX using F BPXOINIT,SHUTDOWN.
Procedure

    Prevent new TSO/E logons and shut down other z/OS subsystems (such as CICS® and IMS), following your typical procedures.

    _______________________________________________________________
    Shut down all JES initiators.

    _______________________________________________________________
    Move or unmount all of the NFS file systems by issuing the following command:

    F OMVS,STOPPFS=NFS

    _______________________________________________________________
    Use normal shutdown procedures to end all file system address spaces such as TCP/IP and DFSS. Do this after the final warning has been sent to users that the system is ending.

    _______________________________________________________________
    End running daemons such as inetd. Then end any remaining processes.
    To obtain a list of daemons that are running, issue:

    D OMVS,U=OMVSKERN

    OMVSKERN is the user ID that is used for the kernel and daemons.
    To display all processes (most daemons have recognizable names), issue:

    D OMVS,A=ALL

    Then use the F BPXOINIT,TERM=xxxxxxxx operator command or the kill command to terminate those processes.

    _______________________________________________________________
    Move or unmount all file systems (including the root file system). Issue:

    F BPXOINIT,SHUTDOWN=FILEOWNER

    or

    F BPXOINIT,SHUTDOWN=FILESYS

    _______________________________________________________________
    Take down JES. At this point, there might still be a number of initiators that are provided by WLM for use on fork and spawn. These initiators time out after 30 minutes on their own, but you can end them by issuing:

    F BPXOINIT,SHUTDOWN=FORKINIT

    _______________________________________________________________

Results
When you are done, you have ended all of the processes. You can do any of the following:

    IPL
    Power® off
    Take down JES, restart JES, and then rebuild your environment. For example:
        Remount any file systems that you unmounted. To do all the mounts, you must issue mount commands or construct a REXX exec or CLIST. If you are using automount for user file systems, there will be less work involved.
        If you terminated the address spaces for TCP/IP and DFSS, you must restart these.
        If you terminated daemons, log on to TSO as superuser and run /etc/rc from a shell or from the ISHELL.
        Notify users that the system is once again available for UNIX processing.




